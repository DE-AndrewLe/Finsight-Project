!pip install -U vnstock
from vnstock import *
import pandas as pd

filtered_df =df.query('epsGrowth5Year > 0 & pe < 9 & pb < 1.2 & lastQuarterProfitGrowth > 0.2')
filtered_df = filtered_df.sort_values(by='pe', ascending=False)

# Calculate total weight
total_weight = 1.0  

# Set weights based on normalized ranks (phân bổ theo EPS giảm dần)
filtered_df['weight'] = filtered_df['pe'].rank(ascending=True) / filtered_df.shape[0]

# Normalize weights to sum to total_weight
filtered_df['weight'] = filtered_df['weight'] * total_weight / filtered_df['weight'].sum()

# Label tickers with weights (optional)
labeled_tickers = []
for index, row in filtered_df.iterrows():
    ticker = row['ticker']  # Replace 'Mã' with your actual ticker column name
    weight = row['weight']
    labeled_tickers.append(f"{ticker}: {weight:.2f}")

# Print labeled tickers (optional)
print("Labeled tickers with weights:")
for ticker in labeled_tickers:
    print(ticker)
